# 📌 DeadLock

# [1] DeadLock이란?

<p align="center"><img src="https://t1.daumcdn.net/cfile/tistory/270DA73358FC58F207"></p>

### '교착상태'라고도 하며, 두 개 이상의 프로세스 또는 스레드가 서로의 작업이 끝나기만을 기다리는 <span style='color: #2D3748; background-color: #fff5b1;'>무한 대기에 빠지는 상태</span>를 말합니다.

### 시스템적으로 한정된 자원을 여러 곳에서 사용하려고 할 때 발생합니다.

<br/>
<br/>

# [2] DeadLock의 네 가지 필요조건

> 다음의 네 가지 조건을 동시에 만족하면 데드락이 됩니다.

## [2-1] 상호 배제 조건

### '상호 배제'란 여러 프로세스가 동시에 한 자원에 접근하지 못하도록 막는 기법입니다.

### 이러한 상호 배제 조건이 성립되면 **한 번에 하나의 프로세스만이 자원을 갖게 되어** 데드락의 원인이 됩니다.

<br/>

## [2-2] 점유와 대기 조건

### 한 프로세스가 자원을 점유한 상태로 다른 자원을 **추가로 점유하기 위해 대기할 수 있다면** 데드락의 원인이 됩니다.

<br/>

## [2-3] 비선점 조건

### 프로세스에 할당된 자원의 작업이 완료될 때까지 시스템에서 **강제로 뺏을 수 없다면** 데드락의 원인이 됩니다.

<br/>

## [2-4] 순환 대기 조건

### 점유와 대기의 형태로 **순환 사이클에 갇혀서 빠져나올 수 없는 상황이라면** 데드락의 원인이 됩니다.

<br/>
<br/>

# [3] DeadLock의 해결법

## [3-1] 예방 및 회피

## [3-1-1] 예방

### 데드락 발생 조건 네 가지 중 하나 이상을 제거하여 해결하는 방법입니다. 즉 각 조건을 방지하여 데드락 발생 가능성을 차단하는 것입니다. 하지만 이 방법은 <span style='color: #2D3748; background-color: #fff5b1;'>자원 낭비</span>가 굉장히 심합니다.

### 회피법은 예방법보다는 조금 덜 제한적인 방법으로 예방법의 단점을 일부 해결할 수 있습니다.

<br/>

## [3-1-2] 회피

### 데드락 발생시 피해가자는 것입니다.

### 대표적으로 <span style='color: #2D3748; background-color: #fff5b1;'>은행원 알고리즘</span>이 있습니다.

### 은행원 알고리즘은 시스템을 안전 상태와 불안전 상태로 구분하고, 불안전 상태일 때는 데드락이 발생할 가능성이 있다고 판단하여 요청을 안정 상태가 될 때까지 대기시키고, 안정 상태일 때만 자원을 할당하여 데드락을 회피합니다.

### 하지만 시스템의 동적인 자원에 비해, 은행원 알고리즘은 할당할 자원 수 고정, 프로세스 수 고정 등 많은 조건이 필요하기 때문에 현실적으로 불가능한 방법입니다.

### 탐지 및 회복 같은 경우에는 데드락이 발생할 것 같을 때 탐지하고 복구하는 반면, 회피는 자원을 요청할 때마다 시스템의 상태를 판단하고 회피하는 전략이기 때문에 <span style='color: #2D3748; background-color: #fff5b1;'>오버헤드</span>가 훨씬 심합니다.

<br/>

## [3-2] 탐지 및 회복

### 데드락이 되도록 허용한 다음 회복시키는 방법으로, 데드락이 자주 발생하는 시스템에서 일반적으로 사용하는 방법입니다.

### 예방 및 회피보다 일반적으로 탐지 및 복구 방법을 사용합니다. 데드락은 '필요악'이기 때문입니다.

### 필요 조건 중 하나를 거부하고 예방한다면, 자원을 효율적으로 사용할 수 없습니다.

<br/>

## [3-2-1] 탐지

### 데드락 존재 여부 및 데드락에 연관된 프로세스와 자원을 알아내자는 전략입니다.

### 네 가지 조건 중에서도 순환 대기 존재 여부에 초점을 맞추어 데드락을 탐지합니다.

### 대표적인 방법으로 <span style='color: #2D3748; background-color: #fff5b1;'>자원할당 그래프</span>를 통해 탐지하는 방법이 있습니다.

### 프로세스와 자원과의 관계를 그래프로 나타내고, 자원노드와 자원으로 향하는 화살표를 모두 제거해서 프로세스 간의 순환을 알아내자는 전략입니다. 탐지 알고리즘도 회피 알고리즘과 마찬가지로 오버헤드가 있기 때문에 얼마나 자주 탐지 알고리즘을 호출하는지가 포인트입니다.

### 하지만 시스템마다 데드락이 발생하는 빈도수가 다르기 때문에 다른 기준을 가지고 호출해야 하는데, 주기적으로 탐지 알고리즘을 돌릴 수 있고, 자원 즉시 할당 여부를 통해 탐지 알고리즘을 돌릴 수 있고, CPU 이용률을 특정 기준으로 잡아 그 이하라면 탐지 알고리즘을 돌리는 방법이 있습니다.

<br/>

## [3-2-2] 회복

### 탐지에서 순환 대기를 찾아냈다면, 복구에서는 순환 대기를 깨서 데드락으로부터 회복하자는 전략입니다.

### 즉, <span style='color: #2D3748; background-color: #fff5b1;'>데드락을 일으킨 프로세스를 종료하거나 할당된 자원을 해제시켜 회복</span>시키는 방법입니다.

### 복구 알고리즘을 썼을 때 프로세스가 작업 중인 것을 일부 손실하는 것은 감당해야 합니다.

### 순환 대기가 깨질 때까지 프로세스를 종료하는 전략이나, 순환 대기에 포함된 프로세스의 제어권을 뺏고 롤백하는 방법이 있습니다.

### 어떤 프로세스를 희생양으로 삼을 것인지가 포인트 입니다.

### 시스템마다 다른 기준으로 우선순위를 따릅니다.

<br/>

## [3-3] 무시

### 데드락이 드물게 발생하는 시스템에서 일반적으로 사용하는 방법입니다.

### 데드락이 드물게 발생하는 경우 데드락 예방 및 탐지와 관련된 지속적인 오버헤드 및 성능 저하를 발생시키는 것보다, 데드락이 발생하지 않는다고 가정하여 무시하고 필요에 따라 시스템 자체를 재부팅시키는 방식이 더 효율적일 수 있다는 것입니다.

### 윈도우, 유닉스를 포함한 대부분의 운영체제가 이러한 방법을 사용합니다.

<br/>
<br/>

# [4] 생각해 볼까요?🙋‍♀️

```
Q1. 데드락이란 무엇일까요? 발생 조건에 대해 설명해보세요.
Q2. 회피 기법인 은행원 알고리즘에 대해 설명해보세요.
```

<br/>
<br/>

# [5] 참고 자료 및 사진 출처

```
< 참고 자료 >
https://gyoogle.dev/blog/computer-science/operating-system/DeadLock.html
https://hckcksrl.medium.com/deadlock-%EC%9D%B4%EB%9E%80-8100261a66c3
https://velog.io/@ryalya/iOS-CS-Study-Deadlock%EB%8D%B0%EB%93%9C%EB%9D%BD-%EA%B5%90%EC%B0%A9%EC%83%81%ED%83%9C%EB%9E%80

< 사진 출처 >
https://copycode.tistory.com/78
```
